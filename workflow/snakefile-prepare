import glob
import os.path

input_files=glob.glob("input/*.long_reads.fastq.gz")
#print(input_files)
DATASETS=[]
print("Running on the following datasets...")
for this_input_file in input_files:
    this_base_name=os.path.basename(this_input_file)
    #print(this_base_name)
    res = re.findall("(.+).long_reads.fastq.gz", this_base_name)
    if not res: continue
    print("  ", res[0])
    DATASETS.append(res[0])



rule all:
  input:
    expand("02_subsampled_long_reads/{dataset}/sample_01.fastq", dataset=DATASETS)

rule long_read_filter:
    input:
        "input/{sample}_long_reads.fastq.gz"
    output:
        "01_trimmed_reads/{sample}_long_reads.fastq"
    conda:
        "envs/filtlong.yml"
    shell:
        "filtlong --min_length 1000 --keep_percent 95 {input} > {output}"


rule long_read_subsample:
    input:
        "01_trimmed_reads/{sample}_long_reads.fastq"
    output:
        "02_subsampled_long_reads/{sample}/sample_01.fastq"
    conda:
        "envs/trycycler.yml"
    shell:
        "trycycler subsample --genome_size {config[genome_size]} --reads {input} --count 24 --out_dir 02_subsampled_long_reads/{wildcards.sample}"


